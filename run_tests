#!/bin/sh

nosetests3 -v || exit 1

failed() {
    echo "TESTS FAILED!"
    exit 1
}

for f in tests/pseudoc-roundtrip/*.lst; do
    echo $f
    ./parse_asm.py --roundtrip $f > $f.out || failed
    diff -u $f.exp $f.out || failed
done
echo

for f in tests/*.lst; do
    echo $f
    ./apply_xform.py $f || failed
    diff -u $f.exp.bb $f.out.bb || failed
    diff -u $f.exp.dot $f.out.dot || failed
done
